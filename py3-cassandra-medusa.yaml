# Generated from https://pypi.org/project/cassandra-medusa/
package:
  name: py3-cassandra-medusa
  version: 0.17.1
  epoch: 1
  description: Apache Cassandra backup and restore tool
  copyright:
    - license: Apache-2.0
  dependencies:
    runtime:
      - py3-python-dateutil
      - py3-click
      - py3-click-aliases
      - py3-pyyaml
      - py3-cassandra-driver
      - py3-psutil
      - py3-ffwd
      - py3-lockfile
      - py3-pyopenssl
      - py3-cryptography
      - py3-pycryptodome
      - py3-retrying
      - py3-parallel-ssh
      - py3-ssh2-python
      - py3-ssh-python
      - py3-requests
      - py3-protobuf
      - py3-grpcio
      - py3-grpcio-health-checking
      - py3-grpcio-tools
      - py3-gevent
      - py3-greenlet
      - py3-fasteners
      - py3-datadog
      - py3-botocore
      - py3-dnspython
      - py3-aiohttp
      - py3-boto3
      - py3-gcloud-aio-storage
      - py3-azure-core
      - py3-azure-identity
      - py3-azure-storage-blob
      - python3

environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - wolfi-base

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/thelastpickle/cassandra-medusa
      tag: v${{package.version}}
      expected-commit: 4a34c29ea09010420a7139336a2758a7c765e343

  - name: Python Build
    uses: python/build-wheel

  - uses: strip

subpackages:
  - name: "${{package.name}}-compat"
    description: "Compatibility package to place binaries and docker entrypoints in the location expected by upstream helm charts"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/home/cassandra/"
          ln -sf /usr/bin/py3-cassandra-medusa ${{targets.subpkgdir}}/home/cassandra/medusa

          cp k8s/docker-entrypoint.sh ${{targets.subpkgdir}}/home/cassandra/
          chmod +x ${{targets.subpkgdir}}/home/cassandra/docker-entrypoint.sh

update:
  enabled: true
  github:
    identifier: thelastpickle/cassandra-medusa
    strip-prefix: v
